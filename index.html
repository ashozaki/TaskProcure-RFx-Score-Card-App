<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TaskProcure RFx Scorecard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --tp-primary: #0c3c78;
      --tp-primary-soft: #e7f0fb;
      --tp-accent: #00b894;
      --tp-bg: #f3f5f9;
      --tp-card-bg: #ffffff;
      --tp-border: #d9e2ef;
      --tp-text-main: #1f2933;
      --tp-text-muted: #64748b;
      --radius-lg: 14px;
      --shadow-soft: 0 10px 25px rgba(15, 23, 42, 0.08);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #e3f2ff 0, #f3f5f9 40%, #eef2ff 100%);
      color: var(--tp-text-main);
    }

    .app-shell {
      max-width: 1180px;
      margin: 20px auto 32px;
      padding: 0 16px;
    }

    /* Header */
    .app-header {
      background: linear-gradient(135deg, #0d3b73, #020f2c);
      border-radius: 18px;
      padding: 14px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: var(--shadow-soft);
      color: #fff;
      margin-bottom: 18px;
    }

    .brand-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .brand-logo-wrap {
      width: 42px;
      height: 42px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.06);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.16);
    }

    .brand-logo {
      max-width: 36px;
      max-height: 36px;
      object-fit: contain;
    }

    .brand-title {
      display: flex;
      flex-direction: column;
    }

    .brand-title span:nth-child(1) {
      font-size: 12px;
      opacity: 0.85;
      letter-spacing: 0.14em;
      text-transform: uppercase;
    }

    .brand-title span:nth-child(2) {
      font-size: 18px;
      font-weight: 600;
    }

    .header-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
      font-size: 11px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(15, 23, 42, 0.3);
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 11px;
    }

    .pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.2);
    }

    .header-right small {
      opacity: 0.9;
    }

    /* Main card */
    .card {
      background: var(--tp-card-bg);
      border-radius: var(--radius-lg);
      padding: 16px 18px 18px;
      border: 1px solid var(--tp-border);
      box-shadow: var(--shadow-soft);
    }

    .top-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px 16px;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .project-input-wrap {
      display: flex;
      flex-direction: column;
      gap: 4px;
      min-width: 260px;
    }

    .project-input-wrap label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--tp-text-muted);
    }

    .project-input-wrap input {
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid var(--tp-border);
      font-size: 13px;
      outline: none;
      background: #f8fafc;
    }

    .project-input-wrap input:focus {
      border-color: var(--tp-primary);
      background: #ffffff;
      box-shadow: 0 0 0 2px rgba(12, 60, 120, 0.12);
    }

    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: flex-end;
      align-items: center;
    }

    .btn {
      border-radius: 999px;
      border: 1px solid transparent;
      padding: 7px 12px;
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: all 0.15s ease-out;
      white-space: nowrap;
    }

    .btn-primary {
      background: var(--tp-primary);
      color: #fff;
      border-color: var(--tp-primary);
    }

    .btn-primary:hover {
      background: #082a55;
      border-color: #082a55;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.18);
    }

    .btn-ghost {
      background: #ffffff;
      color: var(--tp-primary);
      border-color: rgba(12, 60, 120, 0.18);
    }

    .btn-ghost:hover {
      background: var(--tp-primary-soft);
    }

    .btn-icon {
      font-size: 14px;
    }

    /* Upper section */
    .upper-section {
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.3fr);
      gap: 12px;
      margin: 8px 0 14px;
    }

    @media (max-width: 900px) {
      .upper-section {
        grid-template-columns: minmax(0, 1fr);
      }
      .header-right {
        align-items: flex-start;
      }
      .toolbar {
        justify-content: flex-start;
      }
    }

    .summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
    }

    .summary-card {
      border-radius: 12px;
      padding: 10px 12px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .summary-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--tp-text-muted);
    }

    .summary-value {
      font-size: 18px;
      font-weight: 600;
    }

    .summary-meta {
      font-size: 11px;
      color: var(--tp-text-muted);
    }

    .summary-highlight {
      color: var(--tp-accent);
    }

    .legend-card {
      border-radius: 12px;
      padding: 10px 12px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      font-size: 11px;
    }

    .legend-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--tp-text-muted);
      margin-bottom: 4px;
    }

    .legend-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 4px;
      font-size: 11px;
    }

    .legend-table th,
    .legend-table td {
      border: 1px solid #dde1ea;
      padding: 3px 6px;
      text-align: center;
    }

    .legend-table th {
      background: #e5edf9;
      font-weight: 600;
    }

    .legend-note {
      margin-top: 6px;
      color: var(--tp-text-muted);
    }

    .badge-warning {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 6px;
      border-radius: 999px;
      background: #fef3c7;
      color: #92400e;
      font-size: 10px;
    }

    .badge-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #f97316;
    }

    /* Table */
    .table-wrap {
      border-radius: 12px;
      border: 1px solid var(--tp-border);
      overflow: auto;
      background: #ffffff;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      min-width: 720px;
      font-size: 12px;
    }

    th,
    td {
      border-bottom: 1px solid #e5e7eb;
      padding: 6px 8px;
      text-align: center;
    }

    th {
      background: #f9fafb;
      font-weight: 600;
      color: #111827;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    td {
      background: #ffffff;
    }

    tr:nth-child(even) td {
      background: #fcfdff;
    }

    tr:hover td {
      background: #f5f8ff;
    }

    .cell-label {
      text-align: left;
      font-weight: 500;
    }

    .cell-subtle {
      color: var(--tp-text-muted);
      font-size: 11px;
    }

    input.score-input,
    input.weight-input,
    input.max-input {
      width: 60px;
      padding: 2px 4px;
      font-size: 12px;
      text-align: center;
      border-radius: 6px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      outline: none;
    }

    input.score-input:focus,
    input.weight-input:focus,
    input.max-input:focus {
      border-color: var(--tp-primary);
      background: #ffffff;
      box-shadow: 0 0 0 1px rgba(12, 60, 120, 0.14);
    }

    .totals-row {
      background: #0b1120;
      color: #e5e7eb;
      font-weight: 600;
    }

    .totals-row td {
      border-bottom: none;
    }

    .totals-row .cell-label {
      color: #f9fafb;
    }

    .totals-row small {
      font-size: 11px;
      color: #cbd5f5;
    }
  </style>

  <!-- SheetJS for Excel export -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>

<body>
  <div class="app-shell">
    <!-- Header with TaskProcure logo -->
    <header class="app-header">
      <div class="brand-left">
        <div class="brand-logo-wrap">
          <img src="logo.png" alt="TaskProcure Logo" class="brand-logo" />
        </div>
        <div class="brand-title">
          <span>TaskProcure RFx Toolkit</span>
          <span>Scorecard &amp; Vendor Ranking</span>
        </div>
      </div>
      <div class="header-right">
        <div class="pill">
          <span class="pill-dot"></span>
          <span>Live scoring ‚Ä¢ Excel export ready</span>
        </div>
        <small>Capture RFx evaluation sections, score vendors, and download a clean scorecard.</small>
      </div>
    </header>

    <main class="card">
      <!-- Project + toolbar -->
      <div class="top-row">
        <div class="project-input-wrap">
          <label for="projectName">Project / RFx Name</label>
          <input
            id="projectName"
            type="text"
            placeholder="e.g. Digital Identity &amp; PKI RFx 2026"
          />
        </div>
        <div class="toolbar">
          <button id="addCriterionBtn" class="btn btn-ghost">
            <span class="btn-icon">‚ûï</span>
            Add Criterion
          </button>
          <button id="addVendorBtn" class="btn btn-ghost">
            <span class="btn-icon">üè∑</span>
            Add Vendor
          </button>
          <button id="exportExcelBtn" class="btn btn-primary">
            <span class="btn-icon">‚¨á</span>
            Export Scorecard to Excel
          </button>
        </div>
      </div>

      <!-- Upper section: summary + legend -->
      <section class="upper-section">
        <div class="summary" id="summaryCards"></div>
        <div class="legend-card">
          <div class="legend-title">Score Options (from your RFx Toolkit)</div>
          <table class="legend-table">
            <tr>
              <th>Score</th>
              <th>Description</th>
            </tr>
            <tr>
              <td>0</td>
              <td>Does not meet requirements</td>
            </tr>
            <tr>
              <td>1</td>
              <td>Partially meets requirements</td>
            </tr>
            <tr>
              <td>2</td>
              <td>Meets requirements</td>
            </tr>
            <tr>
              <td>3</td>
              <td>Exceeds requirements</td>
            </tr>
          </table>
          <div class="legend-note">
            Enter 0‚Äì3 for each vendor against the RFx Evaluation Sections from your scorecard.
          </div>
        </div>
      </section>

      <!-- Scorecard table -->
      <section class="table-wrap">
        <table id="scorecardTable"></table>
      </section>
    </main>
  </div>

  <script>
    // Initial vendors
    let vendors = ["Vendor A", "Vendor B"];

    // RFx Evaluation Sections (75) from your Excel ‚Äì first 20 with weights, rest 0 by default
    let criteria = [
      { id: 1,  name: "Adaptability to Future Technologies", weight: 5,  maxScore: 3 },
      { id: 2,  name: "Alignment with Organizational Goals", weight: 10, maxScore: 3 },
      { id: 3,  name: "API Availability and Functionality", weight: 15, maxScore: 3 },
      { id: 4,  name: "Automation and AI Features", weight: 20, maxScore: 3 },
      { id: 5,  name: "Carbon Footprint Reductions Plans", weight: 25, maxScore: 3 },
      { id: 6,  name: "Cloud Capabilities", weight: 30, maxScore: 3 },
      { id: 7,  name: "Commercial Evaluation (Pricing Model, TCO, Payment terms etc.)", weight: 35, maxScore: 3 },
      { id: 8,  name: "Compatibility with Existing Systems", weight: 40, maxScore: 3 },
      { id: 9,  name: "Compliance & Data Security (GDPR, HIPAA, CCPA etc.)", weight: 45, maxScore: 3 },
      { id: 10, name: "Compliance & Elgibility", weight: 50, maxScore: 3 },
      { id: 11, name: "Contract Terms & Conditions (e.g., MSA, LRA, SOW, Order Form, Pricing Schedules, SLAs, DPAs, etc.)", weight: 55, maxScore: 3 },
      { id: 12, name: "Core Functionalities", weight: 60, maxScore: 3 },
      { id: 13, name: "Corporate Social Responsibility Initiatives", weight: 65, maxScore: 3 },
      { id: 14, name: "Custom Workflow Capabilities", weight: 70, maxScore: 3 },
      { id: 15, name: "Customization for Industry Specific Needs", weight: 75, maxScore: 3 },
      { id: 16, name: "Customization Options", weight: 80, maxScore: 3 },
      { id: 17, name: "Data Migration Support", weight: 85, maxScore: 3 },
      { id: 18, name: "Data Security & Privacy", weight: 90, maxScore: 3 },
      { id: 19, name: "Data Storage and Backup", weight: 95, maxScore: 3 },
      { id: 20, name: "Deployment Speed", weight: 100, maxScore: 3 },
      { id: 21, name: "Downtime and Recovery Plans", weight: 0, maxScore: 3 },
      { id: 22, name: "Encryption Standards", weight: 0, maxScore: 3 },
      { id: 23, name: "Energy Efficiency", weight: 0, maxScore: 3 },
      { id: 24, name: "Environmental Impact", weight: 0, maxScore: 3 },
      { id: 25, name: "Fit For Purpose", weight: 0, maxScore: 3 },
      { id: 26, name: "Flexibility & Adaptability (Vendor's ability to adapt to changing requirements and priorities while minimizing disruption)", weight: 0, maxScore: 3 },
      { id: 27, name: "Functional Requirements", weight: 0, maxScore: 3 },
      { id: 28, name: "Future Proofing Capabilities", weight: 0, maxScore: 3 },
      { id: 29, name: "Governance & Change Management", weight: 0, maxScore: 3 },
      { id: 30, name: "Helpdesk and Ticketing Systems", weight: 0, maxScore: 3 },
      { id: 31, name: "Hypercare/Post Implementation Support", weight: 0, maxScore: 3 },
      { id: 32, name: "Implementation Timeline", weight: 0, maxScore: 3 },
      { id: 33, name: "Implementation, Configuration & Customizations", weight: 0, maxScore: 3 },
      { id: 34, name: "Integration with Existing Systems", weight: 0, maxScore: 3 },
      { id: 35, name: "Interoperability", weight: 0, maxScore: 3 },
      { id: 36, name: "Licensing Model", weight: 0, maxScore: 3 },
      { id: 37, name: "Maintenance and Upgrades", weight: 0, maxScore: 3 },
      { id: 38, name: "Mobile Support", weight: 0, maxScore: 3 },
      { id: 39, name: "Multi-Language Support", weight: 0, maxScore: 3 },
      { id: 40, name: "Multi-Tenancy Options", weight: 0, maxScore: 3 },
      { id: 41, name: "Network Requirements", weight: 0, maxScore: 3 },
      { id: 42, name: "Onboarding & Implementation", weight: 0, maxScore: 3 },
      { id: 43, name: "Post-Go-Live Support", weight: 0, maxScore: 3 },
      { id: 44, name: "Pricing", weight: 0, maxScore: 3 },
      { id: 45, name: "Pricing Proposal", weight: 0, maxScore: 3 },
      { id: 46, name: "Project Management Approach & Methodology", weight: 0, maxScore: 3 },
      { id: 47, name: "Real-Time Monitoring and Alerts", weight: 0, maxScore: 3 },
      { id: 48, name: "Redundancy and Failover Capabilities", weight: 0, maxScore: 3 },
      { id: 49, name: "Remote Monitoring and Management", weight: 0, maxScore: 3 },
      { id: 50, name: "Reporting and Analytics", weight: 0, maxScore: 3 },
      { id: 51, name: "Resources", weight: 0, maxScore: 3 },
      { id: 52, name: "Responsible Disposal of Hardware", weight: 0, maxScore: 3 },
      { id: 53, name: "RFx Questionnaire & Documentation Requested", weight: 0, maxScore: 3 },
      { id: 54, name: "Risk Mitigation Plans", weight: 0, maxScore: 3 },
      { id: 55, name: "Role-Based Access Control", weight: 0, maxScore: 3 },
      { id: 56, name: "Scalability", weight: 0, maxScore: 3 },
      { id: 57, name: "Security Certifications (ISO 27001, SOC 2, etc.)", weight: 0, maxScore: 3 },
      { id: 58, name: "Service & Support", weight: 0, maxScore: 3 },
      { id: 59, name: "Service Level Agreement (SLAs)", weight: 0, maxScore: 3 },
      { id: 60, name: "Single Tenancy", weight: 0, maxScore: 3 },
      { id: 61, name: "Software Updaters and Patch Management", weight: 0, maxScore: 3 },
      { id: 62, name: "Solution Architecture", weight: 0, maxScore: 3 },
      { id: 63, name: "Strategic Fit with IT Roadmap", weight: 0, maxScore: 3 },
      { id: 64, name: "System Integration", weight: 0, maxScore: 3 },
      { id: 65, name: "System Performance and Speed", weight: 0, maxScore: 3 },
      { id: 66, name: "Technical & Functional Requirements", weight: 0, maxScore: 3 },
      { id: 67, name: "Technical Excellence and Innovation (Code Quality & Best Practices, CI/CD, DevOps Integration, TDD)", weight: 0, maxScore: 3 },
      { id: 68, name: "Technical Proposal", weight: 0, maxScore: 3 },
      { id: 69, name: "Technical Requirements", weight: 0, maxScore: 3 },
      { id: 70, name: "Technical Solution", weight: 0, maxScore: 3 },
      { id: 71, name: "Technical Support Availability", weight: 0, maxScore: 3 },
      { id: 72, name: "Third-Party Integrations", weight: 0, maxScore: 3 },
      { id: 73, name: "Total Cost of Ownership (TCO)", weight: 0, maxScore: 3 },
      { id: 74, name: "Training, Documentation & Knowledge Transfer", weight: 0, maxScore: 3 },
      { id: 75, name: "User Interface and Experience (UI/UX)", weight: 0, maxScore: 3 },
      { id: 76, name: "Vendor Compliance with ESG Standards", weight: 0, maxScore: 3 },
      { id: 77, name: "Vendor Responsiveness", weight: 0, maxScore: 3 },
      { id: 78, name: "Vendor‚Äôs Product Roadmap", weight: 0, maxScore: 3 },
      { id: 79, name: "Warranty Terms", weight: 0, maxScore: 3 }
    ];

    // scores[criterionId][vendorName] = numeric value
    let scores = {};

    function ensureScoresStructure() {
      criteria.forEach(c => {
        if (!scores[c.id]) scores[c.id] = {};
        vendors.forEach(v => {
          if (scores[c.id][v] === undefined) scores[c.id][v] = "";
        });
      });
    }

    function calculateTotals() {
      const totals = {};
      vendors.forEach(v => totals[v] = 0);
      let weightSum = 0;

      criteria.forEach(c => {
        const weight = Number(c.weight) || 0;
        weightSum += weight;

        vendors.forEach(v => {
          const raw = Number(scores[c.id]?.[v]) || 0;
          const max = Number(c.maxScore) || 1;
          if (max > 0) {
            const normalized = (raw / max) * weight;
            totals[v] += normalized;
          }
        });
      });

      return { totals, weightSum };
    }

    function renderSummaryCards() {
      const { totals, weightSum } = calculateTotals();
      const summaryDiv = document.getElementById("summaryCards");
      summaryDiv.innerHTML = "";

      const card1 = document.createElement("div");
      card1.className = "summary-card";
      card1.innerHTML = `
        <div class="summary-label">Vendors in Scope</div>
        <div class="summary-value">${vendors.length}</div>
        <div class="summary-meta">Vendors currently being scored.</div>
      `;
      summaryDiv.appendChild(card1);

      const card2 = document.createElement("div");
      card2.className = "summary-card";
      card2.innerHTML = `
        <div class="summary-label">RFx Evaluation Sections</div>
        <div class="summary-value">${criteria.length}</div>
        <div class="summary-meta">Imported from your RFx Toolkit scorecard.</div>
      `;
      summaryDiv.appendChild(card2);

      const card3 = document.createElement("div");
      card3.className = "summary-card";
      const entries = vendors.map(v => ({ name: v, score: totals[v] || 0 }));
      entries.sort((a, b) => b.score - a.score);
      const best = entries[0];
      card3.innerHTML = `
        <div class="summary-label">Leading Vendor (live)</div>
        <div class="summary-value summary-highlight">
          ${best ? `${best.name} (${best.score.toFixed(1)})` : "‚Äî"}
        </div>
        <div class="summary-meta">
          Weight total: ${weightSum}%
          ${
            weightSum !== 100
              ? `<span class="badge-warning"><span class="badge-dot"></span>Consider normalising to 100%</span>`
              : "Perfectly normalised to 100%."
          }
        </div>
      `;
      summaryDiv.appendChild(card3);
    }

    function renderTable() {
      ensureScoresStructure();
      const table = document.getElementById("scorecardTable");
      table.innerHTML = "";

      const { totals } = calculateTotals();

      const headerRow = document.createElement("tr");
      headerRow.innerHTML = `
        <th class="cell-label">RFx Evaluation Section</th>
        <th>Weight %</th>
        <th>Max Score (0‚Äì3)</th>
      `;
      vendors.forEach(v => {
        const th = document.createElement("th");
        th.textContent = v;
        headerRow.appendChild(th);
      });
      const critTotalTh = document.createElement("th");
      critTotalTh.textContent = "Criterion Weighted Score (sum across vendors)";
      headerRow.appendChild(critTotalTh);
      table.appendChild(headerRow);

      criteria.forEach(c => {
        const tr = document.createElement("tr");
        tr.dataset.criterionId = c.id;

        const nameTd = document.createElement("td");
        nameTd.className = "cell-label";
        nameTd.textContent = c.name;
        tr.appendChild(nameTd);

        const weightTd = document.createElement("td");
        const weightInput = document.createElement("input");
        weightInput.type = "number";
        weightInput.className = "weight-input";
        weightInput.value = c.weight;
        weightInput.addEventListener("input", () => {
          c.weight = Number(weightInput.value) || 0;
          renderTable();
          renderSummaryCards();
        });
        weightTd.appendChild(weightInput);
        tr.appendChild(weightTd);

        const maxTd = document.createElement("td");
        const maxInput = document.createElement("input");
        maxInput.type = "number";
        maxInput.className = "max-input";
        maxInput.value = c.maxScore;
        maxInput.addEventListener("input", () => {
          c.maxScore = Number(maxInput.value) || 1;
          renderTable();
          renderSummaryCards();
        });
        maxTd.appendChild(maxInput);
        tr.appendChild(maxTd);

        let criterionWeightedTotal = 0;

        vendors.forEach(v => {
          const td = document.createElement("td");
          const input = document.createElement("input");
          input.type = "number";
          input.className = "score-input";
          input.value = scores[c.id][v];
          input.addEventListener("input", () => {
            scores[c.id][v] = input.value;
            renderTable();
            renderSummaryCards();
          });
          td.appendChild(input);
          tr.appendChild(td);

          const raw = Number(scores[c.id][v]) || 0;
          const max = Number(c.maxScore) || 1;
          const weight = Number(c.weight) || 0;
          if (max > 0) {
            const normalized = (raw / max) * weight;
            criterionWeightedTotal += normalized;
          }
        });

        const critTotalTd = document.createElement("td");
        critTotalTd.textContent = criterionWeightedTotal.toFixed(1);
        tr.appendChild(critTotalTd);

        table.appendChild(tr);
      });

      const totalsRow = document.createElement("tr");
      totalsRow.className = "totals-row";

      const labelTd = document.createElement("td");
      labelTd.className = "cell-label";
      labelTd.innerHTML = `
        Total Vendor Score (0‚Äì100)
        <br /><small>Based on all RFx Evaluation Sections and weights.</small>
      `;
      totalsRow.appendChild(labelTd);

      const spacer1 = document.createElement("td");
      spacer1.textContent = "";
      totalsRow.appendChild(spacer1);

      const spacer2 = document.createElement("td");
      spacer2.textContent = "";
      totalsRow.appendChild(spacer2);

      vendors.forEach(v => {
        const td = document.createElement("td");
        td.textContent = (totals[v] || 0).toFixed(1);
        totalsRow.appendChild(td);
      });

      const rankTd = document.createElement("td");
      const vendorScores = vendors.map(v => ({
        name: v,
        score: totals[v] || 0
      })).sort((a, b) => b.score - a.score);
      const rankStrings = vendorScores.map((vs, idx) => `${idx + 1}) ${vs.name} (${vs.score.toFixed(1)})`);
      rankTd.innerHTML = `<small>${rankStrings.join("  |  ")}</small>`;
      totalsRow.appendChild(rankTd);

      table.appendChild(totalsRow);
    }

    function exportToExcel() {
      const wb = XLSX.utils.book_new();

      const header = ["RFx Evaluation Section", "Weight %", "Max Score"].concat(vendors).concat(["Criterion Weighted Score"]);
      const data = [header];

      criteria.forEach(c => {
        let row = [];
        row.push(c.name, c.weight, c.maxScore);
        let critTotal = 0;
        vendors.forEach(v => {
          const raw = Number(scores[c.id][v]) || 0;
          row.push(raw);
          const max = Number(c.maxScore) || 1;
          const weight = Number(c.weight) || 0;
          if (max > 0) {
            const normalized = (raw / max) * weight;
            critTotal += normalized;
          }
        });
        row.push(Number(critTotal.toFixed(2)));
        data.push(row);
      });

      const { totals } = calculateTotals();
      let totalRow = [];
      totalRow.push("Total Vendor Score (0‚Äì100)", "", "");
      vendors.forEach(v => totalRow.push(Number((totals[v] || 0).toFixed(2))));
      totalRow.push("");
      data.push(totalRow);

      const ws = XLSX.utils.aoa_to_sheet(data);
      XLSX.utils.book_append_sheet(wb, ws, "Scorecard");

      const projectName = document.getElementById("projectName").value || "RFx_Scorecard";
      XLSX.writeFile(wb, projectName.replace(/\s+/g, "_") + ".xlsx");
    }

    document.getElementById("addVendorBtn").addEventListener("click", () => {
      const name = prompt("Vendor name?");
      if (name && !vendors.includes(name.trim())) {
        vendors.push(name.trim());
        renderTable();
        renderSummaryCards();
      }
    });

    document.getElementById("addCriterionBtn").addEventListener("click", () => {
      const name = prompt("New RFx Evaluation Section name?");
      if (!name) return;
      const weight = Number(prompt("Weight % (e.g. 10)?") || "10");
      const maxScore = Number(prompt("Max score (e.g. 3)?") || "3");
      const id = criteria.length ? Math.max(...criteria.map(c => c.id)) + 1 : 1;
      criteria.push({ id, name: name.trim(), weight, maxScore });
      renderTable();
      renderSummaryCards();
    });

    document.getElementById("exportExcelBtn").addEventListener("click", exportToExcel);

    // Initial render
    renderTable();
    renderSummaryCards();
  </script>
</body>
</html>
